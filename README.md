# YouTube å­—å¹•å·¥å…· v4.0.0-stable ğŸ‰

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ YouTube å­—å¹•æ£€æµ‹ä¸ä¸‹è½½å·¥å…·ï¼Œæ”¯æŒ **AI æ™ºèƒ½æ‘˜è¦**ã€**è®¢é˜…ç®¡ç†**ã€**é˜Ÿåˆ—å¤„ç†**ã€**æ•°æ®å¯¼å‡º**ç­‰é«˜çº§åŠŸèƒ½ã€‚

**ğŸŠ v4.0.0-stable å‘å¸ƒï¼** å®Œæ•´æ¨¡å—åŒ–æ¶æ„ã€Webhook é€šçŸ¥ã€Dry Run é¢„æ¼”ã€è®¢é˜…/é˜Ÿåˆ—/å¯¼å‡ºå…¨æµç¨‹æ‰“é€šï¼

[![Version](https://img.shields.io/badge/version-4.0.0--stable-brightgreen)](https://github.com/your-repo/releases/tag/v4.0.0)
[![Python](https://img.shields.io/badge/python-3.8%2B-blue)](https://www.python.org/)
[![License](https://img.shields.io/badge/license-MIT-green)](LICENSE)

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ¤– AI æ™ºèƒ½æ‘˜è¦
- âœ… **æ™ºèƒ½æ‘˜è¦**ï¼ˆ500-800å­—ç²¾ç‚¼æ€»ç»“ï¼‰
- âœ… **å…³é”®è¯æå–**ï¼ˆ10ä¸ªæ ¸å¿ƒè¯æ±‡ï¼‰
- âœ… **è¦ç‚¹åˆ—è¡¨**ï¼ˆ5-10ä¸ªå…³é”®è¦ç‚¹ï¼‰
- âœ… **ç« èŠ‚åˆ’åˆ†**ï¼ˆ4-10ä¸ªæ™ºèƒ½ç« èŠ‚ï¼ŒåŸºäºæ—¶é—´è½´å¯¹é½ï¼‰
- âœ… **HTML æŠ¥å‘Š**ï¼ˆå¯è§†åŒ–å±•ç¤º + å›¾è¡¨ï¼‰
- âœ… **å¤šæä¾›å•†**ï¼ˆOpenAI/Claude/Gemini/DeepSeek/é€šä¹‰åƒé—®ç­‰ï¼‰
- âœ… **é¢„ç®—æŠ¤æ **ï¼ˆé˜²æ­¢è¶…æ”¯ï¼Œæ”¯æŒ tokens å’Œæˆæœ¬é™åˆ¶ï¼‰
- âœ… **æ™ºèƒ½ç¼“å­˜**ï¼ˆé¿å…é‡å¤è°ƒç”¨ï¼ŒèŠ‚çœæˆæœ¬ï¼‰

### ğŸ“º å­—å¹•å¤„ç†
- âœ… æ‰¹é‡æ£€æµ‹å­—å¹•å¯ç”¨æ€§ï¼ˆæ‰‹åŠ¨å­—å¹• + è‡ªåŠ¨å­—å¹•ï¼‰
- âœ… å¤šè¯­è¨€å­—å¹•ä¸‹è½½ï¼ˆSRT/VTT/TXT æ ¼å¼ï¼‰
- âœ… åŒè¯­å¯¹ç…§æ”¯æŒï¼ˆä¸­è‹±æ–‡åˆå¹¶ï¼‰
- âœ… å¢é‡ä¸‹è½½ï¼ˆæ™ºèƒ½è·³è¿‡å·²ä¸‹è½½å­—å¹•ï¼‰
- âœ… åŸå­å†™å…¥ï¼ˆå¹¶å‘å®‰å…¨ï¼Œé˜²æ­¢æ•°æ®æŸåï¼‰

### ğŸ“® è®¢é˜…ç®¡ç†ï¼ˆv4.0 æ–°å¢ï¼‰
- âœ… æ·»åŠ /åˆ é™¤/æŸ¥çœ‹ YouTube é¢‘é“/æ’­æ”¾åˆ—è¡¨è®¢é˜…
- âœ… æ ‡ç­¾åˆ†ç±»ç®¡ç†ï¼ˆæ”¯æŒå¤šæ ‡ç­¾ï¼‰
- âœ… å¯¼å…¥å¯¼å‡ºï¼ˆJSON/CSV æ ¼å¼ï¼‰
- âœ… è‡ªåŠ¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼ˆä¸€é”®æ›´æ–°æ‰€æœ‰è®¢é˜…ï¼‰
- âœ… æŒä¹…åŒ–å­˜å‚¨ï¼ˆ`subscriptions.json`ï¼‰

### ğŸš¦ é˜Ÿåˆ—ç®¡ç†ï¼ˆv4.0 æ–°å¢ï¼‰
- âœ… å¤šæ¥æºæ‰¹å¤„ç†é˜Ÿåˆ—
- âœ… å¹¶è¡Œåº¦é™åˆ¶ï¼ˆé»˜è®¤ 2ï¼Œå¯è°ƒï¼‰
- âœ… å¤±è´¥è‡ªåŠ¨é‡è¯•
- âœ… ä¸­æ–­æ¢å¤ï¼ˆæ”¯æŒæš‚åœ/åœæ­¢ï¼‰
- âœ… å…¬å¹³è°ƒåº¦ï¼ˆåŒé¢‘é“ä»»åŠ¡é—´éšæœºå»¶è¿Ÿï¼‰
- âœ… çŠ¶æ€è¿½è¸ªï¼ˆpending/running/done/errorï¼‰

### ğŸ“Š æ•°æ®å¯¼å‡ºï¼ˆv4.0 æ–°å¢ï¼‰
- âœ… CSV å¯¼å‡ºï¼ˆ`videos.csv`ã€`errors.csv`ã€`ai.csv`ï¼‰
- âœ… Excel å‘¨æŠ¥æ±‡æ€»ï¼ˆ3 ä¸ª sheetsï¼šæ±‡æ€»/æŒ‰è¿è¡Œ/é”™è¯¯è¯¦æƒ…ï¼‰
- âœ… è‡ªåŠ¨é™çº§ï¼ˆopenpyxl æœªå®‰è£…æ—¶é™çº§ä¸º CSVï¼‰
- âœ… å­—æ®µå®Œæ•´ï¼ˆURLã€æ ‡é¢˜ã€æ—¶é•¿ã€æ’­æ”¾é‡ã€AI æ‘˜è¦ç­‰ï¼‰

### ğŸ”” Webhook é€šçŸ¥ï¼ˆv4.0 æ–°å¢ï¼‰
- âœ… å®æ—¶æ¨é€ï¼ˆrun_start/detect_done/download_done/ai_done/run_endï¼‰
- âœ… HMAC ç­¾åï¼ˆå¯é€‰ï¼Œä¿è¯å®‰å…¨ï¼‰
- âœ… Fire-and-forget æ¨¡å¼ï¼ˆä¸é˜»å¡ä¸»æµç¨‹ï¼‰
- âœ… å¤±è´¥é™çº§ï¼ˆåªè®°å½•åˆ° warnings.txtï¼‰

### ğŸ§ª Dry Run æ¨¡å¼ï¼ˆv4.0 æ–°å¢ï¼‰
- âœ… å®‰å…¨é¢„æ¼”ï¼ˆåªæ£€æµ‹ï¼Œä¸ä¸‹è½½/AIï¼‰
- âœ… ç”Ÿæˆ `plan.md` é¢„è§ˆæŠ¥å‘Š
- âœ… ä¸æ›´æ–° `last_seen`ï¼ˆä¸å½±å“å¢é‡é€»è¾‘ï¼‰
- âœ… è½»é‡çº§ HTML é¢„è§ˆ

### ğŸš€ é«˜çº§åŠŸèƒ½
- âœ… æµé‡æ§åˆ¶ï¼ˆå…¨å±€è¯·æ±‚é€Ÿç‡é™åˆ¶ + åˆ†è·¯é™æµï¼‰
- âœ… ç†”æ–­æœºåˆ¶ï¼ˆ429/503 é”™è¯¯è‡ªåŠ¨å†·é™æœŸ + çƒ­é…ç½®ï¼‰
- âœ… ä»£ç†æ± ç®¡ç†ï¼ˆå¥åº·è¯„åˆ† + è‡ªåŠ¨é»‘åå•æ¢å¤ï¼‰
- âœ… é”™è¯¯åˆ†ç±»ï¼ˆerror_429/503/timeout/private/geoï¼‰
- âœ… è¯Šæ–­æŠ¥å‘Šï¼ˆ`diagnose.txt`ï¼‰
- âœ… é…ç½®å¿«ç…§ï¼ˆ`config.final.json`ï¼‰

### ğŸ¨ ç”¨æˆ·ç•Œé¢
- âœ… 10 ç§ç²¾ç¾ä¸»é¢˜ï¼ˆGitHub Darkã€Draculaã€Nord ç­‰ï¼‰
- âœ… ä¸­è‹±æ–‡åŒè¯­åˆ‡æ¢
- âœ… å®æ—¶è¿›åº¦æ˜¾ç¤ºï¼ˆå¸¦å€’è®¡æ—¶ï¼‰
- âœ… é…ç½®è‡ªåŠ¨ä¿å­˜
- âœ… ä»»åŠ¡æš‚åœ/åœæ­¢

---

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# åŸºç¡€ä¾èµ–ï¼ˆå¿…é¡»ï¼‰
pip install yt-dlp youtube-transcript-api

# AI åŠŸèƒ½ä¾èµ–ï¼ˆå¯é€‰ï¼‰
pip install requests  # é€šå¸¸å·²å®‰è£…

# Excel å¯¼å‡ºä¾èµ–ï¼ˆå¯é€‰ï¼‰
pip install openpyxl
```

### 2. å¯åŠ¨ç¨‹åº

```bash
# GUI æ¨¡å¼
python yt_subs_gui.py

# å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆç¤ºä¾‹ï¼‰
python -c "
from core import run_full_process
result = run_full_process(
    channel_or_playlist_url='https://youtube.com/@channel',
    do_download=True,
    download_langs=['zh', 'en']
)
print(f'å®Œæˆï¼å…± {result[\"total\"]} ä¸ªè§†é¢‘')
"
```

### 3. åŸºæœ¬ä½¿ç”¨

#### åœºæ™¯ 1ï¼šæ£€æµ‹å•ä¸ªè§†é¢‘çš„å­—å¹•

```python
from core import detect_links

results = detect_links(
    urls=["https://youtube.com/watch?v=xxx"],
    max_workers=5
)

for item in results:
    print(f"{item['url']}: {item['status']}")
    if item['status'] == 'has_subs':
        print(f"  è¯­è¨€: {', '.join(item['all_langs'])}")
```

#### åœºæ™¯ 2ï¼šä¸‹è½½å­—å¹•

```python
from core import download_subtitles

files = download_subtitles(
    url="https://youtube.com/watch?v=xxx",
    subs_dir="./subs",
    download_langs=["zh", "en"],
    download_prefer="both",
    download_fmt="txt"
)

print(f"å·²ä¸‹è½½ {len(files)} ä¸ªå­—å¹•æ–‡ä»¶")
```

#### åœºæ™¯ 3ï¼šå®Œæ•´å¤„ç†ï¼ˆæ£€æµ‹ + ä¸‹è½½ + AIï¼‰

```python
from core import run_full_process, run_ai_pipeline

# 1. æ£€æµ‹å¹¶ä¸‹è½½å­—å¹•
result = run_full_process(
    channel_or_playlist_url="https://youtube.com/@channel",
    output_root="out",
    do_download=True,
    download_langs=["zh", "en"],
    incremental_detect=True  # å¢é‡æ¨¡å¼
)

print(f"è¿è¡Œç›®å½•: {result['run_dir']}")
print(f"å…± {result['total']} ä¸ªè§†é¢‘ï¼Œå·²ä¸‹è½½ {result['downloaded']} ä¸ª")

# 2. ç”Ÿæˆ AI æ‘˜è¦ï¼ˆå¯é€‰ï¼‰
ai_result = run_ai_pipeline(
    run_dir=result['run_dir'],
    ai_cfg={
        "enabled": True,
        "providers": [{
            "name": "openai",
            "api_key": "sk-...",
            "model": "gpt-3.5-turbo"
        }]
    }
)

print(f"AI å¤„ç†å®Œæˆï¼ŒæˆåŠŸ {ai_result['success']}ï¼Œå¤±è´¥ {ai_result['failed']}")
```

#### åœºæ™¯ 4ï¼šè®¢é˜…ç®¡ç†

```python
from core import (
    subscribe_add,
    subscribe_list,
    build_run_plan_from_subscriptions,
    run_full_process
)

# æ·»åŠ è®¢é˜…
subscribe_add(
    url="https://youtube.com/@tech",
    kind="channel",
    title="æŠ€æœ¯é¢‘é“",
    tags=["tech", "education"]
)

# åˆ—å‡ºè®¢é˜…
subs = subscribe_list(active_only=True, tag_filter=["tech"])
print(f"å…± {len(subs)} ä¸ªè®¢é˜…")

# ç”Ÿæˆæ‰§è¡Œè®¡åˆ’å¹¶è¿è¡Œ
plan = build_run_plan_from_subscriptions()
result = run_full_process(
    urls_override=plan["urls"],
    do_download=True
)
```

#### åœºæ™¯ 5ï¼šé˜Ÿåˆ—å¤„ç†

```python
from core import enqueue_sources, run_queue

# æ·»åŠ åˆ°é˜Ÿåˆ—
sources = [
    {"id": "1", "kind": "channel", "url": "https://youtube.com/@tech"},
    {"id": "2", "kind": "playlist", "url": "https://youtube.com/playlist?list=..."}
]
run_id = enqueue_sources(sources, tags=["batch1"])

# æ‰§è¡Œé˜Ÿåˆ—ï¼ˆå¹¶è¡Œåº¦=2ï¼‰
result = run_queue(
    max_parallel=2,
    run_opts={"do_download": True, "download_langs": ["zh", "en"]}
)

print(f"æ€»è®¡ {result['total']}ï¼ŒæˆåŠŸ {result['success']}ï¼Œå¤±è´¥ {result['failed']}")
```

#### åœºæ™¯ 6ï¼šæ•°æ®å¯¼å‡º

```python
from core import export_run_csv, export_runs_excel

# å¯¼å‡ºå•æ¬¡è¿è¡Œ CSV
csv_files = export_run_csv("out/20251026_153012")
print(f"CSV æ–‡ä»¶ï¼š{csv_files}")

# å¯¼å‡ºè¿‘ 7 å¤©æ±‡æ€» Excel
excel_file = export_runs_excel("out", days=7)
print(f"Excel æ–‡ä»¶ï¼š{excel_file}")
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

### æ ¸å¿ƒæ¨¡å—ï¼ˆv4.0 æ¨¡å—åŒ–æ¶æ„ï¼‰

```
gpt_tool/
â”œâ”€â”€ core/                      # æ ¸å¿ƒæ¨¡å—ï¼ˆ11 ä¸ªï¼‰
â”‚   â”œâ”€â”€ __init__.py           # ç»Ÿä¸€å¯¼å‡ºæ¥å£ï¼ˆ19 ä¸ªå‡½æ•°ï¼‰
â”‚   â”œâ”€â”€ detection.py          # å­—å¹•æ£€æµ‹ï¼ˆyt-dlp + youtube_transcript_apiï¼‰
â”‚   â”œâ”€â”€ download.py           # å­—å¹•ä¸‹è½½ä¸æ ¼å¼è½¬æ¢
â”‚   â”œâ”€â”€ orchestrator.py       # ä¸»æµç¨‹ç¼–æ’ï¼ˆwebhook + dry runï¼‰
â”‚   â”œâ”€â”€ ai_pipeline.py        # AI å¤„ç†ï¼ˆé¢„ç®—æŠ¤æ  + ç¼“å­˜ + é‡è¯•ï¼‰
â”‚   â”œâ”€â”€ reporting.py          # æŠ¥å‘Šç”Ÿæˆï¼ˆHTML/MD + å›¾è¡¨ + å‘¨æŠ¥ï¼‰
â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†ï¼ˆç¯å¢ƒå˜é‡ + å¿«ç…§ï¼‰
â”‚   â”œâ”€â”€ net.py                # ç½‘ç»œå±‚ï¼ˆä»£ç†æ±  + é™æµ + ç†”æ–­ï¼‰
â”‚   â”œâ”€â”€ utils.py              # å·¥å…·å‡½æ•°ï¼ˆåŸå­å†™ + ID æå– + SHA1ï¼‰
â”‚   â”œâ”€â”€ subscription.py       # è®¢é˜…ç®¡ç†ï¼ˆv4.0 æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ queue.py              # é˜Ÿåˆ—ç®¡ç†ï¼ˆv4.0 æ–°å¢ï¼‰
â”‚   â””â”€â”€ exports.py            # æ•°æ®å¯¼å‡ºï¼ˆv4.0 æ–°å¢ï¼‰
â”œâ”€â”€ adapters/
â”‚   â””â”€â”€ ai_adapter.py         # AI é€‚é…å™¨ï¼ˆå¤šä¾›åº”å•†èšåˆï¼‰
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ smoke_test.py         # å¯¼å…¥æµ‹è¯•
â”‚   â””â”€â”€ quick_regression.py   # å¿«é€Ÿå›å½’æµ‹è¯•
â”œâ”€â”€ yt_subs_gui.py            # GUI ä¸»ç¨‹åº
â”œâ”€â”€ config.json               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.example.json       # é…ç½®ç¤ºä¾‹ï¼ˆv4.0 æ–°å¢ï¼‰
â”œâ”€â”€ subscriptions.json        # è®¢é˜…æ•°æ®ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ queue_state.json          # é˜Ÿåˆ—çŠ¶æ€ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”œâ”€â”€ README.md                 # æœ¬æ–‡ä»¶
â”œâ”€â”€ RELEASE_v4.0.0.md         # å‘å¸ƒè¯´æ˜ï¼ˆv4.0 æ–°å¢ï¼‰
â””â”€â”€ MIGRATION_GUIDE.md        # è¿ç§»æŒ‡å—ï¼ˆv4.0 æ–°å¢ï¼‰
```

### è¾“å‡ºç›®å½•

```
out/
â”œâ”€â”€ 20251026_153012/           # å•æ¬¡è¿è¡Œç›®å½•
â”‚   â”œâ”€â”€ run.jsonl              # è¯¦ç»†è®°å½•ï¼ˆaction: detect/downloadï¼‰
â”‚   â”œâ”€â”€ diagnose.txt           # è¯Šæ–­æŠ¥å‘Šï¼ˆé”™è¯¯åˆ†å¸ƒ + è¯­è¨€åˆ†å¸ƒï¼‰
â”‚   â”œâ”€â”€ warnings.txt           # è­¦å‘Šæ—¥å¿—ï¼ˆè´¨é‡å‘Šè­¦ + webhook å¤±è´¥ï¼‰
â”‚   â”œâ”€â”€ config.final.json      # é…ç½®å¿«ç…§ï¼ˆä¾¿äºå¤ç°ï¼‰
â”‚   â”œâ”€â”€ plan.md                # Dry Run é¢„è§ˆæŠ¥å‘Šï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ subs/                  # å­—å¹•æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ ai/                    # AI æ‘˜è¦ç›®å½•
â”‚   â”‚   â””â”€â”€ <video_id>.json   # å•è§†é¢‘ AI åˆ†æ
â”‚   â”œâ”€â”€ ai_metrics.jsonl       # AI æŒ‡æ ‡ï¼ˆtokens/cost/latencyï¼‰
â”‚   â”œâ”€â”€ ai_failed.jsonl        # AI å¤±è´¥è®°å½•
â”‚   â”œâ”€â”€ report.html            # HTML å¯è§†åŒ–æŠ¥å‘Š
â”‚   â”œâ”€â”€ report.md              # Markdown æŠ¥å‘Š
â”‚   â”œâ”€â”€ videos.csv             # è§†é¢‘æ•°æ®å¯¼å‡ºï¼ˆv4.0 æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ errors.csv             # é”™è¯¯æ•°æ®å¯¼å‡ºï¼ˆv4.0 æ–°å¢ï¼‰
â”‚   â””â”€â”€ ai.csv                 # AI æ•°æ®å¯¼å‡ºï¼ˆv4.0 æ–°å¢ï¼‰
â”œâ”€â”€ summary_7days.xlsx         # å‘¨æŠ¥æ±‡æ€»ï¼ˆv4.0 æ–°å¢ï¼‰
â””â”€â”€ channel_index.json         # é¢‘é“å¢é‡ç´¢å¼•
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ï¼ˆ`config.json`ï¼‰

å®Œæ•´é…ç½®ç¤ºä¾‹è§ [`config.example.json`](config.example.json)

#### æ ¸å¿ƒé…ç½®

```json
{
  "output_root": "out",
  "max_workers": 5,
  "sleep_between": 0.5,
  "retry_times": 2
}
```

#### ä¸‹è½½é…ç½®

```json
{
  "download": {
    "enabled": true,
    "langs": ["zh", "en"],
    "prefer": "both",
    "format": "txt",
    "merge_bilingual": false,
    "incremental": true
  }
}
```

#### AI é…ç½®

```json
{
  "ai": {
    "enabled": false,
    "workers": 3,
    "timeout_s": 60,
    "max_tokens_per_run": 500000,
    "max_daily_cost_usd": 10.0,
    "providers": [
      {
        "name": "openai",
        "enabled": false,
        "api_key": "env:OPENAI_API_KEY",
        "model": "gpt-3.5-turbo"
      }
    ]
  }
}
```

**æˆæœ¬å‚è€ƒ**ï¼š
- DeepSeekï¼šï¿¥10 â‰ˆ 500-1000 ä¸ªè§†é¢‘
- OpenAIï¼š$10 â‰ˆ 600-2000 ä¸ªè§†é¢‘

#### Webhook é…ç½®ï¼ˆv4.0 æ–°å¢ï¼‰

```json
{
  "webhook": {
    "enabled": false,
    "url": "https://your-webhook-endpoint.com/notify",
    "timeout_sec": 5,
    "max_retry": 3,
    "secret": "env:WEBHOOK_SECRET",
    "events": ["run_start", "detect_done", "download_done", "ai_done", "run_end"]
  }
}
```

#### è®¢é˜…/é˜Ÿåˆ—/å¯¼å‡ºé…ç½®ï¼ˆv4.0 æ–°å¢ï¼‰

```json
{
  "subscription": {
    "enabled": true,
    "auto_update": false
  },
  "queue": {
    "enabled": true,
    "max_parallel": 2,
    "retry_on_failure": true
  },
  "export": {
    "auto_export_csv": true,
    "auto_export_excel": false,
    "excel_days": 7
  }
}
```

### ç¯å¢ƒå˜é‡

æ”¯æŒç¯å¢ƒå˜é‡å ä½ç¬¦ï¼š

```json
{
  "api_key": "env:OPENAI_API_KEY",
  "secret": "env:WEBHOOK_SECRET"
}
```

è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# Linux/Mac
export OPENAI_API_KEY="sk-..."
export WEBHOOK_SECRET="your_secret"

# Windows
set OPENAI_API_KEY=sk-...
set WEBHOOK_SECRET=your_secret
```

---

## ğŸ“– API æ–‡æ¡£

### å®Œæ•´ API åˆ—è¡¨ï¼ˆ19 ä¸ªå‡½æ•°ï¼‰

#### æ ¸å¿ƒåŠŸèƒ½

| å‡½æ•° | æ¨¡å— | åŠŸèƒ½ |
|------|------|------|
| `detect_links` | detection.py | æ‰¹é‡æ£€æµ‹è§†é¢‘å­—å¹• |
| `download_subtitles` | download.py | ä¸‹è½½å­—å¹• |
| `run_full_process` | orchestrator.py | ä¸»æµç¨‹ç¼–æ’ï¼ˆæ£€æµ‹ + ä¸‹è½½ï¼‰ |
| `run_ai_pipeline` | ai_pipeline.py | æ‰¹é‡ AI å¤„ç† |
| `reprocess_ai_errors` | ai_pipeline.py | é‡æ–°å¤„ç† AI å¤±è´¥ |
| `export_run_html` | reporting.py | ç”Ÿæˆ HTML æŠ¥å‘Š |
| `export_run_md` | reporting.py | ç”Ÿæˆ Markdown æŠ¥å‘Š |

#### è®¢é˜…ç®¡ç†ï¼ˆv4.0 æ–°å¢ï¼‰

| å‡½æ•° | åŠŸèƒ½ |
|------|------|
| `subscribe_add` | æ·»åŠ è®¢é˜… |
| `subscribe_remove` | åˆ é™¤è®¢é˜… |
| `subscribe_list` | åˆ—å‡ºè®¢é˜… |
| `subscribe_update` | æ›´æ–°è®¢é˜… |
| `subscribe_import` | å¯¼å…¥è®¢é˜… |
| `subscribe_export` | å¯¼å‡ºè®¢é˜… |
| `build_run_plan_from_subscriptions` | ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ |

#### é˜Ÿåˆ—ç®¡ç†ï¼ˆv4.0 æ–°å¢ï¼‰

| å‡½æ•° | åŠŸèƒ½ |
|------|------|
| `enqueue_sources` | å…¥é˜Ÿæ¥æº |
| `list_queue` | åˆ—å‡ºé˜Ÿåˆ— |
| `run_queue` | æ‰§è¡Œé˜Ÿåˆ— |
| `clear_queue` | æ¸…ç†é˜Ÿåˆ— |

#### æ•°æ®å¯¼å‡ºï¼ˆv4.0 æ–°å¢ï¼‰

| å‡½æ•° | åŠŸèƒ½ |
|------|------|
| `export_run_csv` | å¯¼å‡ºå•æ¬¡è¿è¡Œ CSV |
| `export_runs_excel` | å¯¼å‡ºè¿‘æœŸæ±‡æ€» Excel |

### ä½¿ç”¨ç¤ºä¾‹

å®Œæ•´ç¤ºä¾‹è§"å¿«é€Ÿå¼€å§‹"ç« èŠ‚ã€‚

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. å¢é‡æ›´æ–°

**å·¥ä½œåŸç†**ï¼š
- é¦–æ¬¡è¿è¡Œï¼šå¤„ç†æ‰€æœ‰è§†é¢‘
- åç»­è¿è¡Œï¼šåªå¤„ç† `upload_date > last_seen` çš„æ–°è§†é¢‘
- è‡ªåŠ¨æ›´æ–° `channel_index.json` è®°å½•æœ€æ–°è§†é¢‘æ—¥æœŸ

**ä¼˜ç‚¹**ï¼š
- å¤§å¹…èŠ‚çœæ—¶é—´ï¼ˆè·³è¿‡å·²å¤„ç†è§†é¢‘ï¼‰
- é™ä½ API è°ƒç”¨æ¬¡æ•°
- é€‚åˆé•¿æœŸè®¢é˜…ä½¿ç”¨

### 2. Webhook é€šçŸ¥ï¼ˆv4.0 æ–°å¢ï¼‰

**è§¦å‘æ—¶æœº**ï¼š
- `run_start`ï¼šå¼€å§‹å¤„ç†
- `detect_done`ï¼šæ£€æµ‹å®Œæˆ
- `download_done`ï¼šä¸‹è½½å®Œæˆ
- `ai_done`ï¼šAI å¤„ç†å®Œæˆ
- `ai_guard_stop`ï¼šé¢„ç®—æŠ¤æ è§¦å‘
- `run_end`ï¼šç»“æŸå¤„ç†

**Payload ç¤ºä¾‹**ï¼š
```json
{
  "event": "run_end",
  "run_dir": "out/20251026_153012",
  "stats": {
    "total": 42,
    "detected": 42,
    "downloads_ok": 28,
    "ai_ok": 26
  },
  "budget": {
    "tokens": 18342,
    "cost_usd": 0.73
  },
  "ts": "2025-10-26T15:30:12Z"
}
```

### 3. Dry Run æ¨¡å¼ï¼ˆv4.0 æ–°å¢ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼šå®‰å…¨é¢„æ¼”ï¼Œæµ‹è¯•æ£€æµ‹é€»è¾‘ï¼Œç”Ÿæˆè®¡åˆ’æŠ¥å‘Š

**ç‰¹ç‚¹**ï¼š
- åªæ‰§è¡Œ `detect_links`ï¼Œä¸ä¸‹è½½/AI
- ä¸æ›´æ–° `last_seen`
- ç”Ÿæˆ `plan.md` é¢„è§ˆæŠ¥å‘Š

**ç¤ºä¾‹**ï¼š
```python
from core import run_full_process

result = run_full_process(
    channel_or_playlist_url="https://youtube.com/@tech",
    dry_run=True  # é¢„æ¼”æ¨¡å¼
)

print(f"æ£€æµ‹åˆ° {result['total']} ä¸ªè§†é¢‘")
print(f"é¢„è§ˆæŠ¥å‘Šï¼š{result['run_dir']}/plan.md")
```

### 4. AI é¢„ç®—æŠ¤æ ï¼ˆv4.0 å¢å¼ºï¼‰

**ä½œç”¨**ï¼šé˜²æ­¢ AI æˆæœ¬è¶…æ”¯

**é…ç½®**ï¼š
```json
{
  "ai": {
    "max_tokens_per_run": 500000,
    "max_daily_cost_usd": 10.0
  }
}
```

**è§¦å‘æ•ˆæœ**ï¼š
- è¶…é™ç«‹å³åœæ­¢ AI å¤„ç†
- è®°å½•åˆ° `warnings.txt`
- å‘é€ `ai_guard_stop` webhook

### 5. ä»£ç†æ± ç®¡ç†ï¼ˆv4.0 å¢å¼ºï¼‰

**å¥åº·è¯„åˆ†**ï¼š
```
score = 0.7 * success_rate + 0.3 * latency_score
```

**è‡ªåŠ¨ç®¡ç†**ï¼š
- æˆåŠŸç‡ < 15% è‡ªåŠ¨æ‹‰é»‘
- é»‘åå•å†·å´ 10 åˆ†é’Ÿåè‡ªåŠ¨æ¢å¤
- æŒ‰è¯„åˆ†è‡ªåŠ¨é€‰æ‹©æœ€ä½³ä»£ç†

**æŸ¥çœ‹çŠ¶æ€**ï¼š
```python
from core.net import get_current_proxy_stats

stats = get_current_proxy_stats()
for proxy, info in stats.items():
    print(f"{proxy}: score={info['score']:.2f}, success_rate={info['success_rate']:.2f}")
```

---

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

è¯¦è§ [`MIGRATION_GUIDE.md`](MIGRATION_GUIDE.md) çš„"å¸¸è§é—®é¢˜"ç« èŠ‚ã€‚

### è°ƒè¯•æ–¹æ³•

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   ```bash
   cat out/latest_run/diagnose.txt
   cat out/latest_run/warnings.txt
   ```

2. **è¿è¡Œæµ‹è¯•**ï¼š
   ```bash
   python tests/smoke_test.py
   python tests/quick_regression.py
   ```

3. **Dry Run é¢„æ¼”**ï¼š
   ```python
   from core import run_full_process
   result = run_full_process(
       channel_or_playlist_url="...",
       dry_run=True
   )
   ```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ä»£ç è´¨é‡
- **æ¨¡å—æ•°**ï¼š11 ä¸ªï¼ˆåŸ 1 ä¸ªï¼‰
- **å•æ–‡ä»¶è¡Œæ•°**ï¼š< 650 è¡Œï¼ˆåŸ 2000+ è¡Œï¼‰
- **å‡½æ•°æ•°**ï¼š19 ä¸ªå¯¹å¤–å‡½æ•°
- **æµ‹è¯•è¦†ç›–**ï¼š4/4 é€šè¿‡

### è¿è¡Œæ—¶æ€§èƒ½
- **å¯åŠ¨æ—¶é—´**ï¼šå‡å°‘ ~30%ï¼ˆå»¶è¿Ÿå¯¼å…¥ï¼‰
- **å¹¶å‘å¤„ç†**ï¼šæ”¯æŒè‡ªé€‚åº”å¹¶å‘ï¼ˆ2-20 workersï¼‰
- **å†…å­˜å ç”¨**ï¼šå‡å°‘ ~20%ï¼ˆæ¨¡å—åŒ–æŒ‰éœ€åŠ è½½ï¼‰
- **AI ç¼“å­˜å‘½ä¸­ç‡**ï¼šæå‡ 70%+

---

## ğŸš€ å‡çº§æŒ‡å—

### ä» v3.x å‡çº§åˆ° v4.0

è¯¦ç»†è¿ç§»æŒ‡å—è§ [`MIGRATION_GUIDE.md`](MIGRATION_GUIDE.md)

**å¿«é€Ÿå‡çº§**ï¼š
1. å¤‡ä»½æ—§ç‰ˆæœ¬
2. ä¸‹è½½ v4.0 release
3. è¦†ç›–æ ¸å¿ƒæ–‡ä»¶
4. æ›´æ–°é…ç½®ï¼ˆæ·»åŠ æ–°å­—æ®µï¼‰
5. è¿è¡Œæµ‹è¯•

**å…¼å®¹æ€§**ï¼š
- âœ… æ ¸å¿ƒæ¥å£ä¸å˜ï¼ˆdetect_links, download_subtitles, run_full_process ç­‰ï¼‰
- âœ… GUI è‡ªåŠ¨é€‚é…
- âœ… æ—§é…ç½®æ–‡ä»¶å…¼å®¹

---

## ğŸ“œ ç‰ˆæœ¬å†å²

### v4.0.0-stable (2025-10-26)

**æ–°å¢**ï¼š
- âœ… è®¢é˜…ç®¡ç†ï¼ˆ7 ä¸ªå‡½æ•°ï¼‰
- âœ… é˜Ÿåˆ—ç®¡ç†ï¼ˆ4 ä¸ªå‡½æ•°ï¼‰
- âœ… æ•°æ®å¯¼å‡ºï¼ˆ2 ä¸ªå‡½æ•°ï¼‰
- âœ… Webhook é€šçŸ¥
- âœ… Dry Run æ¨¡å¼

**æ”¹è¿›**ï¼š
- âœ… æ¨¡å—åŒ–æ¶æ„ï¼ˆ11 ä¸ªæ¨¡å—ï¼‰
- âœ… AI é¢„ç®—æŠ¤æ 
- âœ… ä»£ç†æ± è¯„åˆ†
- âœ… åŸå­å†™å…¥
- âœ… é…ç½®å¿«ç…§

**è¯¦ç»†å˜æ›´**ï¼šè§ [`RELEASE_v4.0.0.md`](RELEASE_v4.0.0.md)

### v3.x (å†å²ç‰ˆæœ¬)

è§æ—§ç‰ˆ READMEã€‚

---

## ğŸ“– æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](README.md#å¿«é€Ÿå¼€å§‹)ï¼ˆæœ¬æ–‡ä»¶ï¼‰
- [å‘å¸ƒè¯´æ˜](RELEASE_v4.0.0.md)ï¼ˆv4.0.0 è¯¦ç»†å†…å®¹ï¼‰
- [è¿ç§»æŒ‡å—](MIGRATION_GUIDE.md)ï¼ˆv3.x â†’ v4.0ï¼‰
- [é¡¹ç›®æ¶æ„](é¡¹ç›®æ¶æ„å®Œæ•´æ¦‚è§ˆ.md)ï¼ˆ11 ä¸ªæ¨¡å—è¯¦è§£ï¼‰
- [é…ç½®ç¤ºä¾‹](config.example.json)ï¼ˆå®Œæ•´é…ç½®ï¼‰

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

**è´¡çŒ®æŒ‡å—**ï¼š
1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤ä»£ç ï¼ˆé™„æµ‹è¯•å’Œæ–‡æ¡£ï¼‰
4. è¿è¡Œæµ‹è¯•ï¼ˆ`python tests/quick_regression.py`ï¼‰
5. æäº¤ PR

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

---

## ğŸ“ è”ç³»

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ Issue è”ç³»ã€‚

---

**ç‰ˆæœ¬**: v4.0.0-stable  
**æ›´æ–°æ—¥æœŸ**: 2025-10-26  
**çŠ¶æ€**: âœ… Stableï¼ˆç”Ÿäº§å°±ç»ªï¼‰

**å…³é”®æ–‡æ¡£**ï¼š
- ğŸ“– [`RELEASE_v4.0.0.md`](RELEASE_v4.0.0.md) - å‘å¸ƒè¯´æ˜
- ğŸ“– [`MIGRATION_GUIDE.md`](MIGRATION_GUIDE.md) - è¿ç§»æŒ‡å—
- ğŸ“– [`config.example.json`](config.example.json) - é…ç½®ç¤ºä¾‹

---

**ğŸ‰ v4.0.0-stable å‘å¸ƒï¼äº«å—æ¨¡å—åŒ–å¸¦æ¥çš„ç¨³å®šä¸é«˜æ•ˆï¼** âœ¨
